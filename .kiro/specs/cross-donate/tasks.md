# CrossDonate Implementation Tasks

## 概要

このタスクリストは、CrossDonateプロジェクトの並行開発を前提とした実装計画です。スマートコントラクトチームとフロントエンドチームが効率的に協力できるよう、明確な依存関係と優先順位を設定しています。

## 実装タスク

### 1. プロジェクト初期セットアップ

- [x] 1.1 リポジトリ構造の作成
  - ethglobal-online-2025/ディレクトリ構造の作成
  - pnpm workspace設定（contract、frontend）
  - ルートpackage.jsonの設定（Node.js 22+、pnpm@10.13.1）
  - _Requirements: 7.4, 7.5_

- [x] 1.2 開発環境の統一設定
  - Biome設定ファイル（@biomejs/biome@1.9.4）の作成
  - .gitignoreファイルの設定
  - 環境変数テンプレート（.env.example）の作成
  - _Requirements: 7.4_

- [ ] 1.3 共有設定ファイルの作成
  - チェーン設定（Sepolia、Arbitrum Sepolia）
  - トークン設定（ETH、USDC、PYUSD）
  - コントラクトアドレス管理用の設定ファイル
  - _Requirements: 5.2, 7.2_

### 2. スマートコントラクト開発

- [ ] 2.1 Hardhat V3プロジェクトのセットアップ
  - contract/ディレクトリの初期化
  - Hardhat V3設定ファイルの作成
  - 必要な依存関係のインストール（OpenZeppelin等）
  - _Requirements: 1.4, 7.4_

- [ ] 2.2 DonationPoolコントラクトの実装
  - 基本的な状態変数の定義（owner、targetToken、supportedTokens等）
  - コンストラクタの実装
  - 寄付受取機能（donateETH、donate）の実装
  - _Requirements: 1.1, 2.1, 5.1_

- [ ] 2.3 残高管理機能の実装
  - getBalance、getAllBalances関数の実装
  - 内部残高管理ロジックの実装
  - 残高確認用のview関数群の実装
  - _Requirements: 4.1, 6.1_

- [ ] 2.4 集約・変換機能の実装
  - initiateConversion関数の実装
  - withdrawFunds関数の実装
  - Avail Nexus SDK連携の基本構造実装
  - _Requirements: 2.2, 2.3, 3.2_

- [ ] 2.5 アクセス制御とセキュリティ機能
  - onlyOwner modifierの実装
  - ReentrancyGuardの統合
  - カスタムエラーの定義と実装
  - _Requirements: 3.1, 3.2_

- [ ] 2.6 CREATE2Factoryコントラクトの実装
  - CREATE2を使用したデプロイ機能
  - アドレス事前計算機能
  - デプロイ済みプール管理機能
  - _Requirements: 1.1, 1.2_

- [ ]* 2.7 スマートコントラクトのユニットテスト
  - DonationPoolの基本機能テスト
  - CREATE2Factoryのテスト
  - エラーケースのテスト
  - _Requirements: 1.1, 2.1, 3.1_

- [ ] 2.8 ローカルネットワークでのテスト
  - Hardhatローカルネットワークでの動作確認
  - 統合テスト用のデプロイスクリプト作成
  - ABI出力とフロントエンド連携準備
  - _Requirements: 1.1, 2.1_

- [ ] 2.9 テストネットデプロイ
  - Sepolia、Arbitrum Sepoliaへのデプロイ
  - デプロイ済みアドレスの記録と共有
  - コントラクト検証（Etherscan）
  - _Requirements: 1.1, 7.1_

### 3. フロントエンド開発

- [ ] 3.1 Next.js 15プロジェクトのセットアップ
  - frontend/ディレクトリの初期化
  - Next.js 15 + TypeScript + TailwindCSSの設定
  - 必要な依存関係のインストール（Wagmi、RainbowKit等）
  - _Requirements: 5.1, 7.4_

- [ ] 3.2 基本レイアウトとルーティング
  - App Routerの設定（layout.tsx、page.tsx）
  - ヘッダー、フッター、ナビゲーションコンポーネント
  - 基本的なページ構造（ホーム、寄付、管理、作成）
  - _Requirements: 4.1, 5.1_

- [ ] 3.3 ウォレット接続機能
  - RainbowKit + Wagmiの設定
  - ウォレット接続コンポーネント
  - ネットワーク切り替え機能
  - _Requirements: 5.1, 5.3_

- [ ] 3.4 寄付者向けインターフェース
  - 統一アドレス表示コンポーネント
  - QRコード生成機能
  - サポートトークン・チェーン表示
  - 寄付履歴表示（モックデータ使用）
  - _Requirements: 5.1, 5.2, 5.4_

- [ ] 3.5 管理者ダッシュボード
  - 残高一覧表示コンポーネント
  - 変換・引き出しコントロール
  - トランザクション履歴表示
  - _Requirements: 4.1, 4.2, 4.4_

- [ ] 3.6 プロジェクト作成機能
  - プロジェクト作成フォーム
  - CREATE2アドレス計算・表示
  - プロジェクト情報のローカルストレージ管理
  - _Requirements: 1.1, 1.2_

- [ ]* 3.7 コンポーネントテスト
  - 主要コンポーネントのユニットテスト
  - モックデータを使用した動作確認
  - レスポンシブデザインの確認
  - _Requirements: 5.1, 4.1_

- [ ] 3.8 モックデータでの動作確認
  - 寄付フローのモック実装
  - 管理者フローのモック実装
  - エラーハンドリングの実装
  - _Requirements: 5.1, 4.1_

### 4. 統合・テスト

- [ ] 4.1 スマートコントラクト統合
  - デプロイ済みコントラクトとの接続
  - 実際のトランザクション送信テスト
  - イベント監視機能の実装
  - _Requirements: 6.1, 6.2_

- [ ] 4.2 リアルタイム機能の実装
  - useContractEventを使用したイベント監視
  - 残高のリアルタイム更新
  - 寄付・変換処理の進捗表示
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 4.3 Avail Nexus SDK統合
  - クロスチェーンブリッジ機能の実装
  - トークンスワップ機能の統合
  - 変換処理フローの完成
  - _Requirements: 2.2, 2.3_

- [ ] 4.4 エラーハンドリングの完成
  - スマートコントラクトエラーの適切な表示
  - ネットワークエラーの処理
  - ユーザーフレンドリーなエラーメッセージ
  - _Requirements: 5.3, 4.2_

- [ ]* 4.5 エンドツーエンドテスト
  - 寄付フローの完全テスト
  - 管理者フローの完全テスト
  - クロスチェーン変換の動作確認
  - _Requirements: 2.1, 4.1, 5.1_

### 5. 最終調整・デモ準備

- [ ] 5.1 UI/UXの最終調整
  - デザインの統一とブラッシュアップ
  - レスポンシブデザインの最適化
  - アクセシビリティの確認
  - _Requirements: 5.1, 7.4_

- [ ] 5.2 パフォーマンス最適化
  - Next.js 15のPartial Prerenderingの活用
  - 不要なリレンダリングの削除
  - バンドルサイズの最適化
  - _Requirements: 7.4_

- [ ] 5.3 デモシナリオの準備
  - ハッカソン向けデモフローの作成
  - PYUSD寄付→USDC変換のデモデータ準備
  - プレゼンテーション用の画面キャプチャ
  - _Requirements: 5.1, 2.2_

- [ ] 5.4 ドキュメント作成
  - README.mdの作成（セットアップ手順）
  - デモ手順書の作成
  - 技術仕様書の最終更新
  - _Requirements: 7.4_

- [ ] 5.5 本番デプロイ
  - フロントエンドのVercelデプロイ
  - 環境変数の設定
  - 動作確認とバグ修正
  - _Requirements: 7.1_

## 並行開発スケジュール

### Phase 1: 準備（Day 1-2）
- タスク 1.1-1.3: プロジェクト初期セットアップ
- タスク 2.1: Hardhatセットアップ
- タスク 3.1: Next.jsセットアップ

### Phase 2: 並行開発（Day 3-10）
**スマートコントラクトチーム:**
- Day 3-5: タスク 2.2-2.4（コア機能実装）
- Day 6-7: タスク 2.5-2.6（セキュリティ・Factory）
- Day 8-9: タスク 2.7-2.8（テスト・ローカル確認）
- Day 10: タスク 2.9（テストネットデプロイ）

**フロントエンドチーム:**
- Day 3-4: タスク 3.2-3.3（基本UI・ウォレット）
- Day 5-6: タスク 3.4-3.5（寄付・管理画面）
- Day 7-8: タスク 3.6-3.7（作成機能・テスト）
- Day 9-10: タスク 3.8（モック動作確認）

### Phase 3: 統合（Day 11-13）
- タスク 4.1-4.4: 統合・リアルタイム機能・エラーハンドリング
- タスク 4.5: エンドツーエンドテスト

### Phase 4: 最終調整（Day 14）
- タスク 5.1-5.5: UI調整・デモ準備・デプロイ

## 成功指標

- [ ] PYUSDでの寄付が正常に動作する
- [ ] Arbitrum SepoliaのUSDCへの変換が完了する
- [ ] 統一アドレスでの寄付受取が機能する
- [ ] 管理者ダッシュボードで残高確認・変換が可能
- [ ] デモが問題なく実行できる