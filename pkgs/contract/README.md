# CrossDonate Smart Contracts

CrossDonate プロジェクトのスマートコントラクト実装です。
CREATE2 と Avail Nexus SDK を用いて **マルチチェーンで統一アドレス**を実現し、複数チェーン・複数トークンからの寄付を安全に受け付け、統一的に管理します。

- Solidity: `^0.8.28`（最適化有効のプロファイル）
- 対応ネットワーク（例）: `sepolia`, `arbitrumSepolia`

---

## 概要

CrossDonate は、寄付の受付から残高・統計の確認、緊急時の資金退避までをカバーします。
CREATE2 により **チェーンを跨いでも同一のデプロイアドレス**を維持できます。

---

## 機能

### DonationPool
- **ETH 寄付**: 直接 ETH の寄付を受け取る
- **ERC20 寄付**: サポート済み ERC20 トークンの寄付を受け取る
- **USDC→PYUSD 変換**: ブリッジされた USDC を PYUSD に自動変換
- **寄付管理**: 寄付額の制限 / 有効・無効切り替え
- **残高管理**: 包括的な残高確認と統計機能
- **セキュリティ**: OpenZeppelin ライブラリによる堅牢実装
- **緊急機能**: 緊急時の資金引き出し機能（ETH / ERC20）

### USDC→PYUSD 変換機能
- **自動変換**: ブリッジされた USDC を PYUSD に 1:1 レートで変換
- **Uniswapライクなスワップ**: ERC20トークン同士の実際のトークン転送
- **Nexus SDK 統合**: クロスチェーンブリッジとスワップを同時実行
- **バッチ処理**: 複数の変換を効率的に処理
- **変換履歴**: 全ての変換を追跡・記録
- **残高管理**: USDC と PYUSD の残高を個別に管理
- **PYUSD送信**: 変換後のPYUSDを指定アドレスに送信
- **完全なスワップフロー**: USDC→PYUSD→送信の一連の流れ

### CREATE2Factory
- **統一アドレス**: CREATE2 を用いたマルチチェーン同一アドレス
- **事前計算**: デプロイ前にアドレスを算出
- **プール管理**: デプロイ済みプールの管理・追跡
- **マルチチェーン対応**: 複数チェーンで一貫したアドレス生成

---

## 要件 / Requirements

- Node.js 22+
- PNPM 10+
- 環境変数（`.env` か CI 上のシークレットに設定）
  - `SEPOLIA_RPC_URL`
  - `ARBITRUM_SEPOLIA_RPC_URL`
  - `PRIVATE_KEY`（デプロイ/テストに用いるアカウント）

> 参考: ルートにある `.env.example` を元に `pkgs/contract/.env` を作成してください。

---

## インストール

**モノレポのルート**で実行:
```sh
pnpm install
